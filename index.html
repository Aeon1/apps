<!DOCTYPE HTML>
<head>
	<meta http-equiv="content-type" content="text/html" />
	<meta name="author" content="Aeon1" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=geometry&sensor=true"></script>
	<title>Ayudate</title>
    <script type="text/javascript" charset="utf-8">
    document.addEventListener("deviceready", onDeviceReady, false);
    function onDeviceReady() {
        navigator.geolocation.getCurrentPosition(onSuccess, onError);
    }

	
    function onConfirm(button) {
       if (button==2){
       navigator.app.exitApp();
    	}
    }
    function showConfirm() {
        navigator.notification.confirm(
    'Desea salir de la aplicacion?',
    onConfirm,
    'Salir', 
        'Cancelar,Salir' 
        );
    }
    var actual;
    var incidencias;
function onSuccess(position) {
    
   
		var latitude = position.coords.latitude; // Latitud
		var longitude = position.coords.longitude; // Longitud
		var initialLocation = new google.maps.LatLng(latitude, longitude);
       actual = new google.maps.LatLng(latitude, longitude);
var spherical;
        spherical = google.maps.geometry.spherical; 
        
   $.ajax({
                type: 'GET',
                url: 'http:www.2030.mx/xxx/web/consultas/coordenadas.php',
                success: function(data){
                    console.log(data);
                    var datos=data.split('*');
                    var num=datos.length;
                    for (i=0;i<num; ++i){
                        var destino = new google.maps.LatLng(datos[i]);
                        var intermedio = google.maps.geometry.spherical.computeDistanceBetween(destino, actual);
                        if (distacia>500){
                            incidencias=incidencias+1
                        }
                    }
                if (incidencias>=3){
                    vibrate();
                }
                },
                error: function(data){
                    console.log(data);
                    alert('Ocurrio un error al recuperar los datos');
                }
            });
	    
         
       
        
        
        
	}

    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
var map;
  function inicialize(){
    var mapOptions = {
          zoom: 13,
          center: actual,
          mapTypeId: google.maps.MapTypeId.TERRAIN
        };
    map = new google.maps.Map(document.getElementById('map_canvas'),
            mapOptions);
             var image="http://mapicons.nicolasmollet.com/wp-content/uploads/mapicons/shape-default/color-0ffa3e/shapecolor-color/shadow-1/border-dark/symbolstyle-white/symbolshadowstyle-dark/gradient-no/smiley_happy.png";
		var marker = new google.maps.Marker({
			position: actual,
			map: map,            
			title: "Estás aquí",
            icon: image
		});
  }
  function vibrate() {
        navigator.notification.vibrate(2000);
    }

    </script>
</head>

<body>

<div data-role="page" id="inicio">
    <div data-theme="a" data-role="header">
        <h3>
            Ciudad segura
        </h3>
    </div>
    <div data-role="content">
       <input type="text" id="coordenadas" />
        <a data-role="button" href="#reportar" data-transition="slide">
            Reportar
        </a>
        <a data-role="button" href="#mapa" data-transition="slide" onclick="inicialize()">
            Lugares de incidencias
        </a>
    </div>
</div>

<div data-role="page" id="reportar">
    <div data-theme="a" data-role="header">
        <h3><a href="#inicio" data-role="button" data-icon="arrow-l" data-iconpos="left" data-inline="true" class="ui-btn-left" data-transition="flip">Atras</a>
            Ciudad segura
        </h3>
    </div>
    <div data-role="content">
    <form>
    <select size="1">
	<option>Tipo de incidente</option>
	<option value="Robo">Robo</option>
	<option value="Violacion">Violacion</option>
	<option value="Calle insegura">Calle insegura</option>
	<option value="Pandillas">Pandillas</option>
	<option value="Personas sospechosas">Personas sospechosas</option>
</select>
    </form>
       
    </div>
</div>
<div data-role="page" id="mapa">
    <div data-theme="a" data-role="header">
        <h3><a href="#inicio" data-role="button" data-icon="arrow-l" data-iconpos="left" data-inline="true" class="ui-btn-left" data-transition="flip">Atras</a>
            Ciudad segura
        </h3>
    </div>
    <div data-role="content">
       <div id="map_canvas" style="width: 100%;height: 400px;"></div>
    </div>
</div>
</body>
</html>
